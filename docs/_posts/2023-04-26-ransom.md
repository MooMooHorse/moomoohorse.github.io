---
layout: post
title:  "Ransomware Attack"
summary: "Preparation for my summer research"
author: moomoohorse
date: '2023-04-26 15:58:39 -0500'
category: ['research']
thumbnail: /assets/img/posts/bytefs.png
keywords: undergraduate-research
permalink: /blog/ransome-research
usemathjax: true
marp : true
theme : gaia 
class : invert
---

Slides at [slides](../assets/_slides/2023-04-26-ransom.pdf)

# Ransome 

## Related resources

[minifilter](https://learn.microsoft.com/en-us/windows-hardware/drivers/ifs/filter-manager-concepts)

[ransom analysis1](https://learn.microsoft.com/en-us/windows-hardware/drivers/ifs/filter-manager-concepts)

[unveil : protection](https://www.usenix.org/conference/usenixsecurity16/technical-sessions/presentation/kharaz)

[hardware protection](https://zhuanlan.zhihu.com/p/31129885)

[hardware protection](https://jianh.web.engr.illinois.edu/papers/flashguard-ccs17-jian.pdf)

---

## Attack Defense Paradigm

I attack your computer based on your OS source code

I protect my computer based on your attack source code

...

Never end

`Testing Frame Work` $\rightarrow$ `Statisitcs`

OK, if system A fails at 5 different virus and system B only fails at 1, who is better? You can't tell.

---

Need an index that's independent from protection method and attack method.

* Ideal defense $\rightarrow$ no ransomware anymore
* k-lag defense, let ransomware run $k\ \micro\text{s}$ and see the destruction.
  * Destruction means the unrecoverable data in mapped disk(target storage region which stores targeted files to ransomware)

Question :

How generic should this testing framework be?



---

### Generic

Generic meeans the testing framework should be  independent of variables. But what are those variables. If storage system types isn't one of these variable, then I think the way is to widely test upon GFS, XFS, mySQL, postgreSQL ...

Variable can also include the type of ransomware : 

---

#### Observation 

* Current ransomware are hard to work with because
  * server might be off-line (20 / 20 aren't working when I randomly fetch ransomwares from virus set).
  * only available on windows, hard to probe
  * some ransomware destorys the system(not the entire system, just ban the other ransomwares and applications), hard to test, need to **reload** the system every time, reload windows takes ~10 minutes

---

* With working ransomware, still
  * hard to standardize, why choose this one over other ransomwares?
  * not summable (fs lost 70% data over ransomware1, 80% data over ransomware2, another file system fs' lost 90% data over ransomware1 50% data over ransomware2), which is better? Can we take sum over any data?
  * Most of ransomwares disregard remote backups, while having access to credential manager.

---

### Standardized ransomware

* Healthy : do nothing except for encryption data
* Transparent : can be adjusted for testing framework
* Working : can encryt data without the existence of server.
* Flexible : can do batch test.

---

#### How does storage systems do their journal?

* Many of the storage systems don't do data journal, they do metadata journal only for performance.
* Some systems do coW, but that's per transaction, the amount of recoverable files are limited.

---

### Data backup

Generic way to defend against ransomware.

So need to study journal and logging behavior...

The most important problem is frequency and expiration rate of those backups, I think.

Now I think those can be omitted because index should be from "stationary" data backups and calculate their ratios.

---

### Remote backups : crisis on credential manager

The following 3 slides are from https://www.nirsoft.net/utils/credentials_file_view.html

#### Data Stored In Credentials Files

Windows operating system stores the following information inside Credentials files:
* Login passwords of remote computers on your LAN.
* Passwords of mail accounts on exchange server (stored by Microsoft Outlook)
* Windows Live session information.

--- 

* Remote Desktop 6 user\password information.
* Internet Explorer 7.x and 8.x: passwords of password-protected Web sites ("Basic Authentication" or "Digest Access Authentication")
* Password of MSN Messenger / Windows Messenger accounts

---

#### Credentials File Location

You can find the Credentials files of Windows in the following locations:
```
C:\Users\[User Profile]\AppData\Roaming\Microsoft\Credentials (Windows Vista and later)
C:\Users\[User Profile]\AppData\Local\Microsoft\Credentials (Windows Vista and later)
C:\Windows\system32\config\systemprofile\AppData\Local\Microsoft\Credentials (Windows 8 and later)
C:\Documents and Settings\[User Profile]\Application Data\Microsoft\Credentials (Windows XP)
C:\Documents and Settings\[User Profile]\Local Settings\Application Data\Microsoft\Credentials (Windows XP)
```
---

Those are no valid locations, but I duplicated `.crd` file to desktop and find the encrypted results.

And there are ways to decryt those account / password 

> CredentialsFileView is a simple tool for Windows that decrypts and displays the passwords and other data stored inside Credentials files of Windows. 

---

#### Ransomware operates at your comp. Message protection will be likely to fail.

You logged in to onedrive today, so your cached verification will bypass the text-message-verification.

Then you have a ransomware.

But in testing framework's perspective, what are we testing against? The expiration rate of cloud service?

**Are we testing subject storage system or the cloud backup sub-system?**

---

### Remote storage 

[summary](https://www.zhihu.com/question/23645117/answer/124708083) (might expire)

[GFS](https://cs.stanford.edu/~matei/courses/2015/6.S897/slides/gfs.pdf)

---

### Implementation

Need this tool to be portable, probably have to encapsulate the code and provide some APIs. However, the probes within BIOs should be enforced (not optional).

~~Ideas, now I don't think these are going to help~~:

* Patch :
  * [kernel patch1](https://netkit-jh.github.io/docs/1.0.0/dev/guides/kernelpatches/#:~:text=To%20create%20kernel%20patches%2C%20firstly,use%20the%20URL%20available%20KERNEL_URL%20.&text=Once%20you%20have%20a%20.,patches%2F%20and%20name%20it%20appropiately.)
  * [kernel patch2](https://www.kernel.org/doc/html/v4.15/process/applying-patches.html)
  * [kernel patch3](https://medium.com/coinmonks/make-linux-kernel-better-beginners-guide-to-writing-your-first-linux-patch-1125e4891e0d)
  * [kernel patch4](https://initialcommit.com/blog/git-format-patch)

---

### Windows & IO

* [Windows7 iso](https://www.softlay.com/downloads/windows-7-home-basic?download=links&opt=1)
* Windows 10 ISO should be available...


--- 


### Current obstacles

1. NTFS does NOT have data journal. Typical ransomwares don't exist on linux.

2. Don't really know how to trace journals and logs(def unable to do it in block level) in **Windows** and with storage systems that I **can't access source code**.
    * Implicit problem, layering : how to trace data backups ?  
3. Might need to build a standardized ransomware(may need to study the repos on github a little bit)

4. False positive : it happens to many Filesystem Filters based detecting tools.

---


### Current obstacles (cont.)

5. I don't think logal backups have any meaning because backups essentially are files.

6. **If local backups failed all the time, then aren't we just testing the cloud service's security. a.k.a. how likely it can be accessed by ransomware?**